name: Commit Intelligence Data

on:
  workflow_run:
    workflows: ["Generate Intelligence Data"]  # Workflow A ì´ë¦„ê³¼ ì¼ì¹˜í•´ì•¼ í•¨
    types:
      - completed

jobs:
  commit:
    runs-on: ubuntu-latest
    # â­ Workflow Aê°€ ì„±ê³µí–ˆì„ ë•Œë§Œ ì‹¤í–‰
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    permissions:
      contents: write  # ì´ì œ write ê¶Œí•œ ì‚¬ìš©
    
    steps:
      - name: Checkout Public Repo
        uses: actions/checkout@v4
        with:
          ref: main  # í•­ìƒ ìµœì‹  main
          
      - name: Download Data Artifact
        uses: actions/download-artifact@v4
        with:
          name: market-data
          path: docs/data/
          github-token: ${{ secrets.GITHUB_TOKEN }}
          run-id: ${{ github.event.workflow_run.id }}
          
      - name: Commit & Push
        run: |
          git config user.name 'PolyBot'
          git config user.email 'bot@noreply.github.com'
          
          git add docs/data/market_signals.json
          
          # ë³€ê²½ì‚¬í•­ ìˆì„ ë•Œë§Œ ì»¤ë°‹
          if git diff --staged --quiet; then
            echo "ğŸ“­ No changes to commit"
          else
            git commit -m "ğŸ¤– Update Signals: $(date -u +'%Y-%m-%d %H:%M UTC')"
            git push
            echo "âœ… Data committed"
          fi
